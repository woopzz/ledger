(()=>{var e={504:function(e){RegExp.escape=function(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")},function(){"use strict";let t;t="undefined"!=typeof jQuery&&jQuery?jQuery:{},t.csv={defaults:{separator:",",delimiter:'"',headers:!0},hooks:{castToScalar:function(e,t){if(isNaN(e))return e;if(/\./.test(e))return parseFloat(e);{const t=parseInt(e);return isNaN(t)?null:t}}},parsers:{parse:function(e,t){const r=t.separator,a=t.delimiter;t.state.rowNum||(t.state.rowNum=1),t.state.colNum||(t.state.colNum=1);const o=[];let n=[],s=0,i="",c=!1;function l(){if(s=0,i="",t.start&&t.state.rowNum<t.start)return n=[],t.state.rowNum++,void(t.state.colNum=1);if(void 0===t.onParseEntry)o.push(n);else{const e=t.onParseEntry(n,t.state);!1!==e&&o.push(e)}n=[],t.end&&t.state.rowNum>=t.end&&(c=!0),t.state.rowNum++,t.state.colNum=1}function u(){if(void 0===t.onParseValue)n.push(i);else if(t.headers&&1===t.state.rowNum)n.push(i);else{const e=t.onParseValue(i,t.state);!1!==e&&n.push(e)}i="",s=0,t.state.colNum++}const d=RegExp.escape(r),f=RegExp.escape(a);let m=/(D|S|\r\n|\n|\r|[^DS\r\n]+)/,p=m.source;return p=p.replace(/S/g,d),p=p.replace(/D/g,f),m=new RegExp(p,"gm"),e.replace(m,(function(e){if(!c)switch(s){case 0:if(e===r){i+="",u();break}if(e===a){s=1;break}if(/^(\r\n|\n|\r)$/.test(e)){u(),l();break}i+=e,s=3;break;case 1:if(e===a){s=2;break}i+=e,s=1;break;case 2:if(e===a){i+=e,s=1;break}if(e===r){u();break}if(/^(\r\n|\n|\r)$/.test(e)){u(),l();break}throw Error("CSVDataError: Illegal State [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]");case 3:if(e===r){u();break}if(/^(\r\n|\n|\r)$/.test(e)){u(),l();break}if(e===a)throw Error("CSVDataError: Illegal Quote [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]");throw Error("CSVDataError: Illegal Data [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]");default:throw Error("CSVDataError: Unknown State [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]")}})),0!==n.length&&(u(),l()),o},splitLines:function(e,r){if(!e)return;const a=(r=r||{}).separator||t.csv.defaults.separator,o=r.delimiter||t.csv.defaults.delimiter;r.state=r.state||{},r.state.rowNum||(r.state.rowNum=1);const n=[];let s=0,i="",c=!1;function l(){if(s=0,r.start&&r.state.rowNum<r.start)return i="",void r.state.rowNum++;if(void 0===r.onParseEntry)n.push(i);else{const e=r.onParseEntry(i,r.state);!1!==e&&n.push(e)}i="",r.end&&r.state.rowNum>=r.end&&(c=!0),r.state.rowNum++}const u=RegExp.escape(a),d=RegExp.escape(o);let f=/(D|S|\n|\r|[^DS\r\n]+)/,m=f.source;return m=m.replace(/S/g,u),m=m.replace(/D/g,d),f=new RegExp(m,"gm"),e.replace(f,(function(e){if(!c)switch(s){case 0:if(e===a){i+=e,s=0;break}if(e===o){i+=e,s=1;break}if("\n"===e){l();break}if(/^\r$/.test(e))break;i+=e,s=3;break;case 1:if(e===o){i+=e,s=2;break}i+=e,s=1;break;case 2:{const t=i.substr(i.length-1);if(e===o&&t===o){i+=e,s=1;break}if(e===a){i+=e,s=0;break}if("\n"===e){l();break}if("\r"===e)break;throw Error("CSVDataError: Illegal state [Row:"+r.state.rowNum+"]")}case 3:if(e===a){i+=e,s=0;break}if("\n"===e){l();break}if("\r"===e)break;if(e===o)throw Error("CSVDataError: Illegal quote [Row:"+r.state.rowNum+"]");throw Error("CSVDataError: Illegal state [Row:"+r.state.rowNum+"]");default:throw Error("CSVDataError: Unknown state [Row:"+r.state.rowNum+"]")}})),""!==i&&l(),n},parseEntry:function(e,t){const r=t.separator,a=t.delimiter;t.state.rowNum||(t.state.rowNum=1),t.state.colNum||(t.state.colNum=1);const o=[];let n=0,s="";function i(){if(void 0===t.onParseValue)o.push(s);else{const e=t.onParseValue(s,t.state);!1!==e&&o.push(e)}s="",n=0,t.state.colNum++}if(!t.match){const e=RegExp.escape(r),o=RegExp.escape(a);let n=/(D|S|\n|\r|[^DS\r\n]+)/.source;n=n.replace(/S/g,e),n=n.replace(/D/g,o),t.match=new RegExp(n,"gm")}return e.replace(t.match,(function(e){switch(n){case 0:if(e===r){s+="",i();break}if(e===a){n=1;break}if("\n"===e||"\r"===e)break;s+=e,n=3;break;case 1:if(e===a){n=2;break}s+=e,n=1;break;case 2:if(e===a){s+=e,n=1;break}if(e===r){i();break}if("\n"===e||"\r"===e)break;throw Error("CSVDataError: Illegal State [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]");case 3:if(e===r){i();break}if("\n"===e||"\r"===e)break;if(e===a)throw Error("CSVDataError: Illegal Quote [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]");throw Error("CSVDataError: Illegal Data [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]");default:throw Error("CSVDataError: Unknown State [Row:"+t.state.rowNum+"][Col:"+t.state.colNum+"]")}})),i(),o}},helpers:{collectPropertyNames:function(e){let t=[],r=[];const a=[];for(t in e)for(r in e[t])e[t].hasOwnProperty(r)&&a.indexOf(r)<0&&"function"!=typeof e[t][r]&&a.push(r);return a}},toArray:function(e,r,a){if(void 0!==r&&"function"==typeof r){if(void 0!==a)return console.error("You cannot 3 arguments with the 2nd argument being a function");a=r,r={}}r=void 0!==r?r:{};const o={};o.callback=void 0!==a&&"function"==typeof a&&a,o.separator="separator"in r?r.separator:t.csv.defaults.separator,o.delimiter="delimiter"in r?r.delimiter:t.csv.defaults.delimiter;const n=void 0!==r.state?r.state:{};r={delimiter:o.delimiter,separator:o.separator,onParseEntry:r.onParseEntry,onParseValue:r.onParseValue,state:n};const s=t.csv.parsers.parseEntry(e,r);if(!o.callback)return s;o.callback("",s)},toArrays:function(e,r,a){if(void 0!==r&&"function"==typeof r){if(void 0!==a)return console.error("You cannot 3 arguments with the 2nd argument being a function");a=r,r={}}r=void 0!==r?r:{};const o={};o.callback=void 0!==a&&"function"==typeof a&&a,o.separator="separator"in r?r.separator:t.csv.defaults.separator,o.delimiter="delimiter"in r?r.delimiter:t.csv.defaults.delimiter;let n=[];if(void 0!==(r={delimiter:o.delimiter,separator:o.separator,onPreParse:r.onPreParse,onParseEntry:r.onParseEntry,onParseValue:r.onParseValue,onPostParse:r.onPostParse,start:r.start,end:r.end,state:{rowNum:1,colNum:1}}).onPreParse&&(e=r.onPreParse(e,r.state)),n=t.csv.parsers.parse(e,r),void 0!==r.onPostParse&&(n=r.onPostParse(n,r.state)),!o.callback)return n;o.callback("",n)},toObjects:function(e,r,a){if(void 0!==r&&"function"==typeof r){if(void 0!==a)return console.error("You cannot 3 arguments with the 2nd argument being a function");a=r,r={}}r=void 0!==r?r:{};const o={};o.callback=void 0!==a&&"function"==typeof a&&a,o.separator="separator"in r?r.separator:t.csv.defaults.separator,o.delimiter="delimiter"in r?r.delimiter:t.csv.defaults.delimiter,o.headers="headers"in r?r.headers:t.csv.defaults.headers,r.start="start"in r?r.start:1,o.headers&&r.start++,r.end&&o.headers&&r.end++;let n=[],s=[];r={delimiter:o.delimiter,separator:o.separator,onPreParse:r.onPreParse,onParseEntry:r.onParseEntry,onParseValue:r.onParseValue,onPostParse:r.onPostParse,start:r.start,end:r.end,state:{rowNum:1,colNum:1},match:!1,transform:r.transform};const i={delimiter:o.delimiter,separator:o.separator,start:1,end:1,state:{rowNum:1,colNum:1},headers:!0};void 0!==r.onPreParse&&(e=r.onPreParse(e,r.state));const c=t.csv.parsers.splitLines(e,i),l=t.csv.toArray(c[0],i);n=t.csv.parsers.splitLines(e,r),r.state.colNum=1,r.state.rowNum=l?2:1;for(let e=0,a=n.length;e<a;e++){const a=t.csv.toArray(n[e],r),o={};for(let e=0;e<l.length;e++)o[l[e]]=a[e];void 0!==r.transform?s.push(r.transform.call(void 0,o)):s.push(o),r.state.rowNum++}if(void 0!==r.onPostParse&&(s=r.onPostParse(s,r.state)),!o.callback)return s;o.callback("",s)},fromArrays:function(e,r,a){if(void 0!==r&&"function"==typeof r){if(void 0!==a)return console.error("You cannot 3 arguments with the 2nd argument being a function");a=r,r={}}r=void 0!==r?r:{};const o={};o.callback=void 0!==a&&"function"==typeof a&&a,o.separator="separator"in r?r.separator:t.csv.defaults.separator,o.delimiter="delimiter"in r?r.delimiter:t.csv.defaults.delimiter;let n="";for(let t=0;t<e.length;t++){const r=e[t],a=[];for(let e=0;e<r.length;e++){let t=void 0===r[e]||null===r[e]?"":r[e].toString();t.indexOf(o.delimiter)>-1&&(t=t.replace(new RegExp(o.delimiter,"g"),o.delimiter+o.delimiter));let n="\n|\r|S|D";n=n.replace("S",o.separator),n=n.replace("D",o.delimiter),t.search(n)>-1&&(t=o.delimiter+t+o.delimiter),a.push(t)}n+=a.join(o.separator)+"\n"}if(!o.callback)return n;o.callback("",n)},fromObjects:function(e,r,a){if(void 0!==r&&"function"==typeof r){if(void 0!==a)return console.error("You cannot 3 arguments with the 2nd argument being a function");a=r,r={}}r=void 0!==r?r:{};const o={};if(o.callback=void 0!==a&&"function"==typeof a&&a,o.separator="separator"in r?r.separator:t.csv.defaults.separator,o.delimiter="delimiter"in r?r.delimiter:t.csv.defaults.delimiter,o.headers="headers"in r?r.headers:t.csv.defaults.headers,o.sortOrder="sortOrder"in r?r.sortOrder:"declare",o.manualOrder="manualOrder"in r?r.manualOrder:[],o.transform=r.transform,"string"==typeof o.manualOrder&&(o.manualOrder=t.csv.toArray(o.manualOrder,o)),void 0!==o.transform){const t=e;e=[];for(let r=0;r<t.length;r++)e.push(o.transform.call(void 0,t[r]))}let n,s=t.csv.helpers.collectPropertyNames(e);if("alpha"===o.sortOrder&&s.sort(),o.manualOrder.length>0){const e=[].concat(o.manualOrder);for(let t=0;t<s.length;t++)e.indexOf(s[t])<0&&e.push(s[t]);s=e}const i=[];let c;o.headers&&i.push(s);for(let t=0;t<e.length;t++){n=[];for(let r=0;r<s.length;r++)c=s[r],c in e[t]&&"function"!=typeof e[t][c]?n.push(e[t][c]):n.push("");i.push(n)}return t.csv.fromArrays(i,r,o.callback)}},t.csvEntry2Array=t.csv.toArray,t.csv2Array=t.csv.toArrays,t.csv2Dictionary=t.csv.toObjects,e.exports&&(e.exports=t.csv)}.call(this)},202:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});const a={ImportBtnClicked:"LedgerImportBtnClicked",FileSelected:"LedgerFileSelected",PaymentsUpdated:"LedgerPaymentsUpdated",ExportBtnClicked:"LedgerExportBtnClicked"}}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,r),n.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=r(202);function t(){document.getElementById("button-import").addEventListener("click",(()=>document.dispatchEvent(new Event(e.Z.ImportBtnClicked)))),document.getElementById("button-export").addEventListener("click",(()=>document.dispatchEvent(new Event(e.Z.ExportBtnClicked))))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()})(),(()=>{"use strict";var e=r(202);const t=r(504),a={ЕГРПОУ:"companyRegistry",МФО:"bankCode",Счет:"account",Валюта:"currency","Номер документа":"docNo","Дата операции":"dateStr","МФО банка":"agentBankCode","Название банка":"agentBank","Счет корреспондента":"agentAccount","ЕГРПОУ корреспондента":"agentCompanyRegistry",Корреспондент:"agent",Сумма:"amountStr","Назначение платежа":"note"};function o(e,t=2){return+(Math.round(e+"e+"+t)+"e-"+t)}function n(e){const t={},r=Object.values(a);for(let a=0;a<r.length;a++)t[r[a]]=e[a];if(!t.docNo){const e="A payment does not have a number!";throw alert(e),Error(e)}switch(t.date=new Date(t.dateStr.split(".").reverse().join("-")),t.date.getMonth()){case 0:case 1:case 2:t.quarter=1;break;case 3:case 4:case 5:t.quarter=2;break;case 6:case 7:case 8:t.quarter=3;break;case 9:case 10:case 11:t.quarter=4}return t.amount=parseFloat(t.amountStr.replaceAll(" ","")),t}const s={};function i(){return Object.values(s)}document.addEventListener(e.Z.ImportBtnClicked,(function(){const t=document.createElement("input");t.type="file",t.click(),t.onchange=t=>{const r=t.target.files[0],a=new CustomEvent(e.Z.FileSelected,{detail:r});document.dispatchEvent(a)}})),document.addEventListener(e.Z.FileSelected,(async function(r){const a=r.detail;if(!a)return;!function(t){for(let e of t)s[e.docNo]=e;document.dispatchEvent(new Event(e.Z.PaymentsUpdated))}(function(e){const r=t.toArrays(e,{separator:";",delimeter:'"'});if(r.length>1&&"ЕГРПОУ"!==r[0][0]){const e="Unexpected CSV data!";throw alert(e),Error(e)}return r.slice(1)}(await a.text()).map((e=>new n(e))))})),document.addEventListener(e.Z.PaymentsUpdated,(function(){const e=i();document.getElementById("payment-tables").innerHTML=function(e){let t=[];const r=function(e){const t={};for(const r of e){const e=r.date.getFullYear(),a=r.quarter;void 0===t[e]?t[e]={[a]:[r]}:null==t[e][a]?t[e][a]=[r]:t[e][a].push(r)}return t}(e);for(const e of Object.keys(r).sort().reverse()){let a=0;const n=[];for(const t of Object.keys(r[e]||{}).sort()){let s=0;const i=[];for(const a of(r[e][t]||[]).sort())s+=a.amount,i.push(`\n                    <tr>\n                        <td class="payment-table-item">${a.dateStr||""}</td>\n                        <td class="payment-table-item">${a.note||""}</td>\n                        <td class="payment-table-item text-align_right">${a.amountStr||""} ${a.currency||""}</td>\n                    </tr>\n                `);a+=s,n.push(`\n                <tr>\n                    <td class="payment-table-item payment-table-item_quarter font-title-2">квартал ${t}</td>\n                    <td class="payment-table-item payment-table-item_quarter text-align_right font-title-2" colspan="2">\n                        ${s} (x 0.05 = ${o(.05*s)})\n                    </td>\n                </tr>\n                ${i.join("")}\n            `)}t.push(`\n            <table class="payment-table">\n                <tr>\n                    <td class="payment-table-item payment-table-item_year font-title">${e}</td>\n                    <td class="payment-table-item payment-table-item_year text-align_right font-title-2" colspan="2">\n                        ${a} (x 0.05 = ${o(.05*a)})\n                    </td>\n                </tr>\n                ${n.join("")}\n            </table>\n        `)}return t.join("")}(e)})),document.addEventListener(e.Z.ExportBtnClicked,(function(){const e=i();if(e.length<1)return void alert("Nothing to download!");const r=[];r.push(Object.keys(a));for(let t of e){const e=[];for(let r of Object.values(a))e.push(t[r]);r.push(e)}const o=(n=r,t.fromArrays(n,{separator:";",delimeter:'"'}));var n;const s=new Blob([o],{type:"text/csv"}),c=window.URL.createObjectURL(s),l=document.createElement("a");l.href=c,l.download="payments.csv",l.click(),l.onclick=e=>window.URL.revokeObjectURL(c)}))})()})();